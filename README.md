# CurrencyBot
Бот для получения стоимости валют.
Цель проекта - изучить java core и прочие основные технологии (Git, Maven, Collections, Stream API, Mockito).

Проект выполнен в виде двух модулей: 
[currency-api](./currency-api) отвечает за получение стоимости валют, а 
[telegram-bot](./telegram-bot) управляет работой тг бота.
Весь основной функционал покрыт тестами и описан в javadoc.

## Модуль currency-api
Для получения стоимости валют используются публичные API. 
Для [отправки запросов](./currency-api/src/main/java/ru/urfu/utils/JsonParser.java) к API, 
[парсинга](./currency-api/src/main/java/ru/urfu/utils/JsonParser.java) откликов и
[кэширования](./currency-api/src/main/java/ru/urfu/utils/CurrencyCache.java) стоимости валюты 
были написаны соответствующие утилиты.

Все подключенные API подводятся под интерфейс [CurrencyApi](./currency-api/src/main/java/ru/urfu/api/CurrencyApi.java) 
c методами получения названия API, списка поддерживаемых валют и стоимости поддерживаемой валюты.

Все классы реализующие данный интерфейс передаются в конструктор сервиса [ApiService](./currency-api/src/main/java/ru/urfu/ApiService.java),
задача которого - быть единой точкой доступа к любому подключённому API. Сложность получения стоимости валюты O(1).

## Модуль telegram-bot
Модуль предназначен для представления пользователю информации о всех подключенных API, получения стоимости валют и добавления валют в "избранные".
Взаимодействие с ботом происходит при помощи "меню" - текстового сообщения с множеством приложенных кнопок.
При нажатии на кнопку меню заменяется на другое меню соответствующее тексту кнопки.

При формировании кнопки указывается текст и колбэк (текст возвращаемый по нажатию на кнопку).
Для перехода к конкретному меню в колбэке необходимо указать в колбэке до 4х параметров при ограничении в 60 символов.
Для сериализации и десериализации параметров был написан абстрактный класс [Callback](.\telegram-bot\src\main\java\ru\urfu\utils\callback\Callback.java)
и множество его наследников для работы с разными наборами параметров.

Все возможные меню описаны двумя интерфейсами:
[CommandMenu](./telegram-bot/src/main/java/ru/urfu/controller/menu/CommandMenu.java) отвечает за отправку нового меню при получении текстовой команды, а
[CallbackMenu](./telegram-bot/src/main/java/ru/urfu/controller/menu/CallbackMenu.java) заменяет существующее меню по нажатию кнопки.
Класс [UpdateController](./telegram-bot/src/main/java/ru/urfu/controller/UpdateController.java) определяет тип обновления (нажатия на кнопку или текстовое сообщение)
и передаёт его для обработки в соответствующее меню.